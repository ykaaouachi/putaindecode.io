{"head":{"layout":"Post","comments":true,"date":"2014-04-29","title":"Introduction √† Gulp","tags":["javascript","tools","gulp"],"authors":["MoOx"],"description":"Vous commencez tous √† connaitre les tasks runners, ces outils qui permettent d'automatiser les t√¢ches de d√©veloppement r√©currentes.‚Ä¶"},"body":"<p>Vous commencez tous √† connaitre les <em>tasks runners</em>, ces outils qui permettent\nd'automatiser les t√¢ches de d√©veloppement r√©currentes.\nPersonnellement\n<a href=\"http://moox.io/slides/2013/grunt-before-after/\">je n'ai</a>\n<a href=\"http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/\">pas arr√™t√©</a>\n<a href=\"http://moox.io/slides/2014/introduction-gulp/\">d'en parler</a>\ndepuis que\n<a href=\"/fr/articles/js/grunt/\">Grunt</a>\n√† d√©terr√© cette vielle probl√©matique, assez r√©cente pour le d√©veloppement Web c√¥t√© front end.</p>\n<p>Il faut avouer que de par l'√©volution du d√©veloppement Web, c√¥t√© front end,\non voit beaucoup de personnes qui n'ont pas de vraies bases de d√©veloppeur.\nJe veux dire par l√† non pas que ces personnes sont incomp√©tentes, mais plut√¥t\nqu'il manque parfois la bonne flemme du d√©veloppeur, celle qui le pousse √† <strong>d√©velopper</strong>\ndes solutions techniques pour mieux d√©velopper des produits.\nIl manque un peu <a href=\"http://fr.wiktionary.org/wiki/algorithmie\">d'algorithmie</a>\ndans les veines, de curiosit√© et d'amour du risque.\nCe n'est pas en restant dans sa zone de confort qu'on va de l'avant. Enfin si vous\navez des exemples contraires, je suis preneur.\nMais tout cela doit provenir du fait que pas mal de m√©tiers dans le web sont nouveaux,\ndont celui de ¬´¬†d√©veloppeur Web front end¬†¬ª et que du coup, peu de personnes ont\ninitialement suivi des formations appropri√©s (pour ma part je proviens d'une\nformation <em>d'analyste-programmeur</em>, conception et d√©veloppement software quoi).\nJe remarque que niveau back end il y a beaucoup moins de lacunes, du fait que\nles probl√©matiques g√©r√©es de ce c√¥t√© sont (il me semble) moins nouvelles.</p>\n<p>Bref. Je ne vais pas m'√©terniser sur une intro du pourquoi on met en place un task\nrunner, ni faire une comparaison entre Make, Rake, Cake, Jake, Grunt, Brunch\net Broccoli.\nRentrons dans le vif. Parlons Gulp.</p>\n<h1 id=\"pourquoi-gulp\"><a href=\"#pourquoi-gulp\" class=\"phenomic-HeadingAnchor\">#</a>Pourquoi Gulp</h1>\n<p>Je vais faire court. Pour faire simple, son point fort r√©side dans le fait qu'il utilise des\n<a href=\"http://dailyjs.com/2012/09/10/streams/\">streams</a> (tl;dr: un flux de donn√©es - en m√©moire)\net qu'il limite au maximum l'utilisation de fichiers.\nAu point qu'il existe une <a href=\"https://github.com/godaddy/gulp-header/issues/4#issuecomment-32111457\">police Gulp</a>\npour vous dire.\nSi vous voulez en savoir plus sur les streams, n'h√©sitez pas √† lire l'article de\nNicolas Froidure <a href=\"http://insertafter.com/fr/blog/gulp_vs_grunt.html\">Gulp remplacera-t-il Grunt¬†?</a>\nqui contient une partie explicative sur les streams.</p>\n<p>Dans la pratique cela √©vite d'avoir un gruntfile qui, si on imagine une task\nsass -> autoprefixer -> csso, passe <a href=\"/fr/articles/css/autoprefixer/mise-en-place/#autoprefixer-avec-grunt\">3 fois par des lectures/√©critures sur le syst√®me\nde fichiers</a>.</p>\n<figure>\n  <img src=\"http://jaysoo.ca/images/grunt-flow-2.png\" alt=\"\" />\n  <figcaption>Sans stream</figcaption>\n</figure>\n<p>Et du coup au lieu d'avoir un fichier de conf d'une soixantaine de lignes, on arrive\n√† avoir <a href=\"/fr/articles/css/autoprefixer/mise-en-place/#autoprefixer-avec-gulp\">quelque chose de concis</a>\n(une vingtaine de ligne seulement).</p>\n<figure>\n  <img src=\"http://jaysoo.ca/images/gulp-flow.png\" alt=\"\" />\n  <figcaption>Avec stream</figcaption>\n</figure>\n<h2 id=\"installation\"><a href=\"#installation\" class=\"phenomic-HeadingAnchor\">#</a>Installation</h2>\n<p>Pour avoir la commande globale sur le syst√®me (comme grunt-cli)¬†:</p>\n<pre><code class=\"hljs language-console\">$ npm <span class=\"hljs-selector-tag\">i</span> -g gulp</code></pre>\n<p>Ensuite dans votre projet¬†:</p>\n<pre><code class=\"hljs language-console\">$ npm <span class=\"hljs-selector-tag\">i</span> -D gulp gulp-util gulp-plumber gulp-WHATEVER</code></pre>\n<p><em>Note¬†: <code>npm i -D</code> == <code>npm install --save-dev</code>, c'est cadeau.</em></p>\n<p>Bon dans mon exemple j'ai mis un peu n'importe quoi, donc on va faire un mini workflow de hipster hacker.</p>\n<h2 id=\"utilisation\"><a href=\"#utilisation\" class=\"phenomic-HeadingAnchor\">#</a>Utilisation</h2>\n<p>On part avec une t√¢che tr√®s simple¬†: transpiler <a href=\"http://cssnext.io\">cssnext</a>.</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-variable\">$ </span>mkdir putaindegulp &#x26;&#x26; cd putaindegulp\n<span class=\"hljs-variable\">$ </span>npm init\n<span class=\"hljs-variable\">$ </span>npm i -D gulp gulp-util gulp-plumber gulp-cssnext gulp-csso minimist</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">var</span> gulp = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp\"</span>)\n<span class=\"hljs-keyword\">var</span> gutil = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp-util\"</span>)\n<span class=\"hljs-keyword\">var</span> plumber = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp-plumber\"</span>)\n<span class=\"hljs-keyword\">var</span> cssnext = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp-cssnext\"</span>)\n<span class=\"hljs-keyword\">var</span> csso = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp-csso\"</span>)\n<span class=\"hljs-keyword\">var</span> options = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"minimist\"</span>)(process.argv.slice(<span class=\"hljs-number\">2</span>))\n\ngulp.task(<span class=\"hljs-string\">\"styles\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n  gulp.src(<span class=\"hljs-string\">\"./src/css/*.css\"</span>)\n    .pipe(!options.production ? plumber() : gutil.noop())\n    .pipe(cssnext({<span class=\"hljs-attr\">sourcemap</span>: !options.production}))\n    .pipe(options.production ? csso() : gutil.noop())\n    .pipe(gulp.dest(<span class=\"hljs-string\">\"./dist/css/\"</span>))\n})\n\ngulp.task(<span class=\"hljs-string\">\"default\"</span>, [<span class=\"hljs-string\">\"styles\"</span>], <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n  gulp.watch(<span class=\"hljs-string\">\"./src/css/**/*\"</span>, [<span class=\"hljs-string\">\"styles\"</span>])\n})</code></pre>\n<p>Voil√† c'est tout. Et heureusement.</p>\n<p>Bon, on se refait l'exemple comment√©¬†:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// bah l√† ok, on est oblig√© d'y passer pour avoir l'API Gulp</span>\n<span class=\"hljs-keyword\">var</span> gulp = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp\"</span>)\n\n  <span class=\"hljs-comment\">// √áa c'est optionnel, c'est pour avoir (entre autres la m√©thode noop())</span>\n  <span class=\"hljs-comment\">// je reviens dessus apr√®s</span>\n  <span class=\"hljs-comment\">// https://github.com/gulpjs/gulp-util</span>\n<span class=\"hljs-keyword\">var</span> gutil = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp-util\"</span>)\n\n  <span class=\"hljs-comment\">// L√† on a Mario le plombier qui fixe la tuyauterie foireuse.</span>\n  <span class=\"hljs-comment\">// Ce plugin patch le probl√®me de stream avec node.js qui fait que tout le process</span>\n  <span class=\"hljs-comment\">// explose √† la moindre erreur (pas pratique en cas de watch par exemple)</span>\n  <span class=\"hljs-comment\">// en gros, il remplace la m√©thode pipe et attrape les erreurs pour les ressortir gentiment</span>\n  <span class=\"hljs-comment\">// https://gist.github.com/floatdrop/8269868</span>\n<span class=\"hljs-keyword\">var</span> plumber = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp-plumber\"</span>)\n\n  <span class=\"hljs-comment\">// Ici, rien de magique, du plugin en veux-tu en voil√†</span>\n<span class=\"hljs-keyword\">var</span> cssnext = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp-cssnext\"</span>)\n<span class=\"hljs-keyword\">var</span> csso = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"gulp-csso\"</span>)\n\n  <span class=\"hljs-comment\">// ici on chope les options de la ligne de commande</span>\n  <span class=\"hljs-comment\">// exemple: pour avoir options.production √† true,</span>\n  <span class=\"hljs-comment\">// il suffit de faire `gulp --production`</span>\n<span class=\"hljs-keyword\">var</span> options = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"minimist\"</span>)(process.argv.slice(<span class=\"hljs-number\">2</span>))\n\n<span class=\"hljs-comment\">// D√©finition d'une t√¢che, un nom et une fonction.</span>\n<span class=\"hljs-comment\">// Ce qui est pratique c'est le fait de pouvoir mettre ce qu'on veut</span>\n<span class=\"hljs-comment\">// y compris un console.log() ^^</span>\n<span class=\"hljs-comment\">// un autre param√®tre peut √™tre ajout√© avant la fonction, qui permet de pr√©ciser</span>\n<span class=\"hljs-comment\">// les d√©pendances (cf task dev plus bas par exemple)</span>\ngulp.task(<span class=\"hljs-string\">\"styles\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n\n  <span class=\"hljs-comment\">// Ici on attrape les fichiers (glob classique)</span>\n  <span class=\"hljs-comment\">// √† la racine (on va consid√©rer que nos fichiers finaux ne seront pas dans</span>\n  <span class=\"hljs-comment\">// des sous dossiers, r√©serv√©s aux partials &#x26; co)</span>\n  gulp.src(<span class=\"hljs-string\">\"./src/css/*.css\"</span>)\n\n    <span class=\"hljs-comment\">// On utilise plumber que si on build en dev, sinon faut que √ßa p√™te, qu'on</span>\n    <span class=\"hljs-comment\">// soit pr√©venu lors d'un build pour la prod</span>\n    .pipe(!options.production ? plumber() : gutil.noop())\n\n    <span class=\"hljs-comment\">// Et l√† on pipe nos plugins</span>\n    <span class=\"hljs-comment\">// toujours en jouant avec les options si besoin</span>\n    .pipe(cssnext({\n      <span class=\"hljs-attr\">compress</span>: options.production,\n      <span class=\"hljs-attr\">sourcemap</span>: !options.production\n    }))\n\n    <span class=\"hljs-comment\">// Super important, on convertit nos streams en fichiers</span>\n    .pipe(gulp.dest(<span class=\"hljs-string\">\"./dist/css/\"</span>))\n})\n\n<span class=\"hljs-comment\">// Ici on a une t√¢che de dev qui lance un watch APRES avoir ex√©cut√© `styles` une fois</span>\ngulp.task(<span class=\"hljs-string\">\"default\"</span>, [<span class=\"hljs-string\">\"styles\"</span>], <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n\n  <span class=\"hljs-comment\">// gulp.watch est natif (pas comme avec grunt)</span>\n  <span class=\"hljs-comment\">// vous noterez qu'ici par exemple on va surveiller tous les fichiers</span>\n  <span class=\"hljs-comment\">// et non pas ceux juste √† la racine par exemple</span>\n  gulp.watch(<span class=\"hljs-string\">\"./src/css/**/*\"</span>, [<span class=\"hljs-string\">\"styles\"</span>])\n})\n\n<span class=\"hljs-comment\">// Comme grunt, `gulp` sans argument lancera la t√¢che `default`.</span></code></pre>\n<p>Bien entendu, vous avez d√©j√† compris que si vous voulez remplacer cssnext par Sass,\nc'est l'histoire de 4 secondes.</p>\n<p>Chez <em>Putain de code !</em> on a aim√© Gulp. Il faut bien avouer que\n<a href=\"https://twitter.com/putaindecode/status/460868992396460032\">√ßa va vite</a>\n(encore plus appr√©ciable lorsque l'on n'a pas de SSD) et que c'est plaisant √†\n√©crire compar√© √† Grunt.\nPas de configurations pas sp√©cialement verbeuse et trop espac√©e.\nAvec Gulp on se sent plus libre, moins contraint.\nDu coup, on avait carr√©ment refait notre site avec Gulp\n(puis au passage un petit refresh graphique tant qu'√† faire).</p>\n<p><strong>Mise √† jour: depuis nous avons encore simplifi√© notre process et nous\nnous sommes pass√© de Gulp.</strong></p>\n<p>Pour aller plus loin, vous n'avez qu'√† ouvrir notre ancien\n<a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/gulpfile.js\">Gulpfile</a>\net regarder nos\n<a href=\"https://github.com/putaindecode/putaindecode.io/tree/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks\">tasks</a>\nde l'√©poque qui vont de\n<a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/clean.js\">la plus simple</a>\n√†\n<a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/contributors.js\">la plus compliqu√©</a>.</p>\n<p>Pour voir des t√¢ches plus ¬´¬†real world example¬†¬ª je vous invite √† regarder les tasks suivantes¬†:</p>\n<ul>\n<li><a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/server.js\">server</a>,\nle server de dev local avec livereload dedans¬†;</li>\n<li><a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/watch.js\">watch</a>,\nle classique et si simple watcher¬†;</li>\n<li><a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/deploy.js\">deploy</a>,\nla t√¢che pour publier le dossier <code>dist/</code> sur les <a href=\"https://pages.github.com/\">gh-pages</a>¬†;</li>\n<li><a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/icons.js\">icons</a>,\nqui transforme des SVG en fontes d'icones avec le bout de CSS qui va bien¬†;</li>\n<li><a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/scripts-linting.js\">scripts-linting</a>,\nqui v√©rifie la qualit√© du code¬†;</li>\n<li><a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/scripts.js\">scripts</a>,\ndu <a href=\"/fr/articles/js/browserify/\">browserify</a> pour nos JS c√¥t√© client¬†;</li>\n<li><a href=\"https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/stylesheets.js\">stylesheets</a>,\nnotre t√¢che pour coder des css du futur¬†;</li>\n</ul>\n<h2 id=\"vous-reprendrez-bien-un-peu-de-gulp--pardon\"><a href=\"#vous-reprendrez-bien-un-peu-de-gulp--pardon\" class=\"phenomic-HeadingAnchor\">#</a>Vous reprendrez bien un peu de‚Ä¶ Gulp*¬†! Pardon.</h2>\n<p>Si vous avez encore envie de d√©tails je vous renvoie sur l'article anglais\n<a href=\"http://markgoodyear.com/2014/01/getting-started-with-gulp/\">Getting started with gulp</a>\nqui d√©taille tellement bien chaque point que m√™me un anglophobe comprendrait.</p>\n<p>Vous avez aussi\n<a href=\"https://github.com/gulpjs/gulp/blob/master/docs/README.md\">une documentation</a>\ntr√®s bien faite, qui comporte carr√©ment\n<a href=\"https://github.com/gulpjs/gulp/tree/master/docs/recipes\">des exemples <em>officiels</em> tout pr√™ts</a>.</p>\n<p>Comme je vous disais plus t√¥t, les auteurs de Gulp sont assez carr√©s et valident\n(ou plut√¥t <em>invalident</em>) <a href=\"https://www.npmjs.org/search?q=gulpplugin\">les plugins</a> qui\nne respectent pas les\n<a href=\"https://github.com/gulpjs/gulp/blob/master/docs/writing-a-plugin/guidelines.md\">r√®gles</a>.\nJe trouve que c'est gage de qualit√©.</p>\n<p>Pour finir quelques liens pour ceux qui en veulent toujours plus¬†:</p>\n<ul>\n<li><a href=\"http://insertafter.com/fr/blog/retour_experience_gulp.html\">Gulp : Retour d'exp√©rience</a></li>\n<li><a href=\"http://jaysoo.ca/2014/01/27/gruntjs-vs-gulpjs/\">Grunt vs. Gulp, au-del√† des chiffres</a> (anglais)</li>\n</ul>\n<pre><code class=\"hljs language-console\">$ gulp <span class=\"hljs-keyword\">bisous\n</span>‚ùØ ‚ô° üòò</code></pre>\n","rawBody":"\nVous commencez tous √† connaitre les _tasks runners_, ces outils qui permettent\nd'automatiser les t√¢ches de d√©veloppement r√©currentes.\nPersonnellement\n [je n'ai](http://moox.io/slides/2013/grunt-before-after/)\n [pas arr√™t√©](http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/)\n [d'en parler](http://moox.io/slides/2014/introduction-gulp/)\n depuis que\n [Grunt](/fr/articles/js/grunt/)\n √† d√©terr√© cette vielle probl√©matique, assez r√©cente pour le d√©veloppement Web c√¥t√© front end.\n\nIl faut avouer que de par l'√©volution du d√©veloppement Web, c√¥t√© front end,\non voit beaucoup de personnes qui n'ont pas de vraies bases de d√©veloppeur.\nJe veux dire par l√† non pas que ces personnes sont incomp√©tentes, mais plut√¥t\nqu'il manque parfois la bonne flemme du d√©veloppeur, celle qui le pousse √† **d√©velopper**\ndes solutions techniques pour mieux d√©velopper des produits.\nIl manque un peu [d'algorithmie](http://fr.wiktionary.org/wiki/algorithmie)\ndans les veines, de curiosit√© et d'amour du risque.\nCe n'est pas en restant dans sa zone de confort qu'on va de l'avant. Enfin si vous\navez des exemples contraires, je suis preneur.\nMais tout cela doit provenir du fait que pas mal de m√©tiers dans le web sont nouveaux,\ndont celui de ¬´¬†d√©veloppeur Web front end¬†¬ª et que du coup, peu de personnes ont\ninitialement suivi des formations appropri√©s (pour ma part je proviens d'une\nformation _d'analyste-programmeur_, conception et d√©veloppement software quoi).\nJe remarque que niveau back end il y a beaucoup moins de lacunes, du fait que\nles probl√©matiques g√©r√©es de ce c√¥t√© sont (il me semble) moins nouvelles.\n\nBref. Je ne vais pas m'√©terniser sur une intro du pourquoi on met en place un task\nrunner, ni faire une comparaison entre Make, Rake, Cake, Jake, Grunt, Brunch\net Broccoli.\nRentrons dans le vif. Parlons Gulp.\n\n# Pourquoi Gulp\n\nJe vais faire court. Pour faire simple, son point fort r√©side dans le fait qu'il utilise des\n[streams](http://dailyjs.com/2012/09/10/streams/) (tl;dr: un flux de donn√©es - en m√©moire)\net qu'il limite au maximum l'utilisation de fichiers.\nAu point qu'il existe une [police Gulp](https://github.com/godaddy/gulp-header/issues/4#issuecomment-32111457)\npour vous dire.\nSi vous voulez en savoir plus sur les streams, n'h√©sitez pas √† lire l'article de\nNicolas Froidure [Gulp remplacera-t-il Grunt¬†?](http://insertafter.com/fr/blog/gulp_vs_grunt.html)\nqui contient une partie explicative sur les streams.\n\nDans la pratique cela √©vite d'avoir un gruntfile qui, si on imagine une task\nsass -> autoprefixer -> csso, passe [3 fois par des lectures/√©critures sur le syst√®me\nde fichiers](/fr/articles/css/autoprefixer/mise-en-place/#autoprefixer-avec-grunt).\n\n<figure>\n  <img src=\"http://jaysoo.ca/images/grunt-flow-2.png\" alt=\"\" />\n  <figcaption>Sans stream</figcaption>\n</figure>\n\nEt du coup au lieu d'avoir un fichier de conf d'une soixantaine de lignes, on arrive\n√† avoir [quelque chose de concis](/fr/articles/css/autoprefixer/mise-en-place/#autoprefixer-avec-gulp)\n(une vingtaine de ligne seulement).\n\n<figure>\n  <img src=\"http://jaysoo.ca/images/gulp-flow.png\" alt=\"\" />\n  <figcaption>Avec stream</figcaption>\n</figure>\n\n## Installation\n\nPour avoir la commande globale sur le syst√®me (comme grunt-cli)¬†:\n\n```console\n$ npm i -g gulp\n```\n\nEnsuite dans votre projet¬†:\n\n```console\n$ npm i -D gulp gulp-util gulp-plumber gulp-WHATEVER\n```\n\n_Note¬†: `npm i -D` == `npm install --save-dev`, c'est cadeau._\n\nBon dans mon exemple j'ai mis un peu n'importe quoi, donc on va faire un mini workflow de hipster hacker.\n\n## Utilisation\n\nOn part avec une t√¢che tr√®s simple¬†: transpiler [cssnext](http://cssnext.io).\n\n```console\n$ mkdir putaindegulp && cd putaindegulp\n$ npm init\n$ npm i -D gulp gulp-util gulp-plumber gulp-cssnext gulp-csso minimist\n```\n\n```js\nvar gulp = require(\"gulp\")\nvar gutil = require(\"gulp-util\")\nvar plumber = require(\"gulp-plumber\")\nvar cssnext = require(\"gulp-cssnext\")\nvar csso = require(\"gulp-csso\")\nvar options = require(\"minimist\")(process.argv.slice(2))\n\ngulp.task(\"styles\", function() {\n  gulp.src(\"./src/css/*.css\")\n    .pipe(!options.production ? plumber() : gutil.noop())\n    .pipe(cssnext({sourcemap: !options.production}))\n    .pipe(options.production ? csso() : gutil.noop())\n    .pipe(gulp.dest(\"./dist/css/\"))\n})\n\ngulp.task(\"default\", [\"styles\"], function() {\n  gulp.watch(\"./src/css/**/*\", [\"styles\"])\n})\n```\n\nVoil√† c'est tout. Et heureusement.\n\nBon, on se refait l'exemple comment√©¬†:\n\n```js\n// bah l√† ok, on est oblig√© d'y passer pour avoir l'API Gulp\nvar gulp = require(\"gulp\")\n\n  // √áa c'est optionnel, c'est pour avoir (entre autres la m√©thode noop())\n  // je reviens dessus apr√®s\n  // https://github.com/gulpjs/gulp-util\nvar gutil = require(\"gulp-util\")\n\n  // L√† on a Mario le plombier qui fixe la tuyauterie foireuse.\n  // Ce plugin patch le probl√®me de stream avec node.js qui fait que tout le process\n  // explose √† la moindre erreur (pas pratique en cas de watch par exemple)\n  // en gros, il remplace la m√©thode pipe et attrape les erreurs pour les ressortir gentiment\n  // https://gist.github.com/floatdrop/8269868\nvar plumber = require(\"gulp-plumber\")\n\n  // Ici, rien de magique, du plugin en veux-tu en voil√†\nvar cssnext = require(\"gulp-cssnext\")\nvar csso = require(\"gulp-csso\")\n\n  // ici on chope les options de la ligne de commande\n  // exemple: pour avoir options.production √† true,\n  // il suffit de faire `gulp --production`\nvar options = require(\"minimist\")(process.argv.slice(2))\n\n// D√©finition d'une t√¢che, un nom et une fonction.\n// Ce qui est pratique c'est le fait de pouvoir mettre ce qu'on veut\n// y compris un console.log() ^^\n// un autre param√®tre peut √™tre ajout√© avant la fonction, qui permet de pr√©ciser\n// les d√©pendances (cf task dev plus bas par exemple)\ngulp.task(\"styles\", function() {\n\n  // Ici on attrape les fichiers (glob classique)\n  // √† la racine (on va consid√©rer que nos fichiers finaux ne seront pas dans\n  // des sous dossiers, r√©serv√©s aux partials & co)\n  gulp.src(\"./src/css/*.css\")\n\n    // On utilise plumber que si on build en dev, sinon faut que √ßa p√™te, qu'on\n    // soit pr√©venu lors d'un build pour la prod\n    .pipe(!options.production ? plumber() : gutil.noop())\n\n    // Et l√† on pipe nos plugins\n    // toujours en jouant avec les options si besoin\n    .pipe(cssnext({\n      compress: options.production,\n      sourcemap: !options.production\n    }))\n\n    // Super important, on convertit nos streams en fichiers\n    .pipe(gulp.dest(\"./dist/css/\"))\n})\n\n// Ici on a une t√¢che de dev qui lance un watch APRES avoir ex√©cut√© `styles` une fois\ngulp.task(\"default\", [\"styles\"], function() {\n\n  // gulp.watch est natif (pas comme avec grunt)\n  // vous noterez qu'ici par exemple on va surveiller tous les fichiers\n  // et non pas ceux juste √† la racine par exemple\n  gulp.watch(\"./src/css/**/*\", [\"styles\"])\n})\n\n// Comme grunt, `gulp` sans argument lancera la t√¢che `default`.\n```\n\nBien entendu, vous avez d√©j√† compris que si vous voulez remplacer cssnext par Sass,\nc'est l'histoire de 4 secondes.\n\nChez _Putain de code !_ on a aim√© Gulp. Il faut bien avouer que\n[√ßa va vite](https://twitter.com/putaindecode/status/460868992396460032)\n(encore plus appr√©ciable lorsque l'on n'a pas de SSD) et que c'est plaisant √†\n√©crire compar√© √† Grunt.\nPas de configurations pas sp√©cialement verbeuse et trop espac√©e.\nAvec Gulp on se sent plus libre, moins contraint.\nDu coup, on avait carr√©ment refait notre site avec Gulp\n(puis au passage un petit refresh graphique tant qu'√† faire).\n\n**Mise √† jour: depuis nous avons encore simplifi√© notre process et nous\nnous sommes pass√© de Gulp.**\n\nPour aller plus loin, vous n'avez qu'√† ouvrir notre ancien\n[Gulpfile](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/gulpfile.js)\net regarder nos\n[tasks](https://github.com/putaindecode/putaindecode.io/tree/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks)\nde l'√©poque qui vont de\n[la plus simple](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/clean.js)\n√†\n[la plus compliqu√©](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/contributors.js).\n\nPour voir des t√¢ches plus ¬´¬†real world example¬†¬ª je vous invite √† regarder les tasks suivantes¬†:\n\n- [server](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/server.js),\nle server de dev local avec livereload dedans¬†;\n- [watch](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/watch.js),\nle classique et si simple watcher¬†;\n- [deploy](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/deploy.js),\nla t√¢che pour publier le dossier `dist/` sur les [gh-pages](https://pages.github.com/)¬†;\n- [icons](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/icons.js),\nqui transforme des SVG en fontes d'icones avec le bout de CSS qui va bien¬†;\n- [scripts-linting](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/scripts-linting.js),\nqui v√©rifie la qualit√© du code¬†;\n- [scripts](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/scripts.js),\ndu [browserify](/fr/articles/js/browserify/) pour nos JS c√¥t√© client¬†;\n- [stylesheets](https://github.com/putaindecode/putaindecode.io/blob/6702dffed608cf6d03141f1dcdbb096a66ff7d8f/tasks/stylesheets.js),\nnotre t√¢che pour coder des css du futur¬†;\n\n## Vous reprendrez bien un peu de‚Ä¶ Gulp*¬†! Pardon.\n\nSi vous avez encore envie de d√©tails je vous renvoie sur l'article anglais\n[Getting started with gulp](http://markgoodyear.com/2014/01/getting-started-with-gulp/)\nqui d√©taille tellement bien chaque point que m√™me un anglophobe comprendrait.\n\nVous avez aussi\n[une documentation](https://github.com/gulpjs/gulp/blob/master/docs/README.md)\ntr√®s bien faite, qui comporte carr√©ment\n[des exemples _officiels_ tout pr√™ts](https://github.com/gulpjs/gulp/tree/master/docs/recipes).\n\nComme je vous disais plus t√¥t, les auteurs de Gulp sont assez carr√©s et valident\n(ou plut√¥t _invalident_) [les plugins](https://www.npmjs.org/search?q=gulpplugin) qui\nne respectent pas les\n[r√®gles](https://github.com/gulpjs/gulp/blob/master/docs/writing-a-plugin/guidelines.md).\nJe trouve que c'est gage de qualit√©.\n\nPour finir quelques liens pour ceux qui en veulent toujours plus¬†:\n\n- [Gulp : Retour d'exp√©rience](http://insertafter.com/fr/blog/retour_experience_gulp.html)\n- [Grunt vs. Gulp, au-del√† des chiffres](http://jaysoo.ca/2014/01/27/gruntjs-vs-gulpjs/) (anglais)\n\n```console\n$ gulp bisous\n‚ùØ ‚ô° üòò\n```\n","__filename":"fr/articles/js/gulp/index.md","__url":"/fr/articles/js/gulp/","__resourceUrl":"/fr/articles/js/gulp/index.html","__dataUrl":"/fr/articles/js/gulp/index.html.4129cc5beb71ac5deef7007861a5c28d.json"}